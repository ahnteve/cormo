// Generated by CoffeeScript 1.3.3

/*
# Collects conditions to query
*/


(function() {
  var DBQuery,
    __hasProp = {}.hasOwnProperty;

  DBQuery = (function() {
    /*
      # Creates a query instance
      # @param {Class} model
    */

    function DBQuery(model) {
      this._model = model;
      this._name = model._name;
      this._adapter = model._connection._adapter;
      this._conditions = {};
    }

    /*
      # Finds a record by id
      # @param {String} id
      # @return {DBQuery} this
    */


    DBQuery.prototype.find = function(id) {
      this._id = id;
      return this;
    };

    DBQuery.prototype.where = function(conditions) {
      var field, target;
      target = this._conditions;
      for (field in conditions) {
        if (!__hasProp.call(conditions, field)) continue;
        target[field] = conditions[field];
      }
      return this;
    };

    /*
      # Executes the query
      # @param {Function} callback
      # @param {Error} callback.error
      # @param {Array<DBModel>} callback.records
      # @return {DBQuery} this
    */


    DBQuery.prototype.exec = function(callback) {
      if (this._id) {
        return this._adapter.findById(this._name, this._id, function(error, record) {
          if (error) {
            return callback(error);
          }
          return callback(null, [record]);
        });
      } else {
        return this._adapter.find(this._name, this._conditions, callback);
      }
    };

    return DBQuery;

  })();

  module.exports = DBQuery;

}).call(this);
