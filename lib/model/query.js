// Generated by CoffeeScript 1.4.0
(function() {
  var ModelQuery, Query;

  Query = require('../query');

  ModelQuery = (function() {

    function ModelQuery() {}

    ModelQuery._createQueryAndRun = function(criteria, data, operation, callback) {
      var query;
      query = new Query(this);
      query[criteria](data);
      if (typeof callback === 'function') {
        query[operation](callback);
      }
      return query;
    };

    ModelQuery._createOptionalQueryAndRun = function(criteria, data, operation, callback) {
      if (typeof data === 'function') {
        return this._createQueryAndRun(criteria, null, operation, data);
      } else {
        return this._createQueryAndRun(criteria, data, operation, callback);
      }
    };

    ModelQuery.find = function(id, callback) {
      return this._createQueryAndRun('find', id, 'exec', callback);
    };

    ModelQuery.findPreserve = function(ids, callback) {
      return this._createQueryAndRun('findPreserve', ids, 'exec', callback);
    };

    ModelQuery.where = function(condition, callback) {
      return this._createOptionalQueryAndRun('where', condition, 'exec', callback);
    };

    ModelQuery.select = function(columns, callback) {
      return this._createOptionalQueryAndRun('select', columns, 'exec', callback);
    };

    ModelQuery.order = function(orders, callback) {
      return this._createOptionalQueryAndRun('order', orders, 'exec', callback);
    };

    ModelQuery.count = function(condition, callback) {
      return this._createOptionalQueryAndRun('where', condition, 'count', callback);
    };

    ModelQuery.update = function(updates, condition, callback) {
      var query;
      if (typeof condition === 'function') {
        callback = condition;
        condition = null;
      }
      query = new Query(this);
      query.where(condition);
      if (typeof callback === 'function') {
        query.update(updates, callback);
      }
      return query;
    };

    ModelQuery["delete"] = function(condition, callback) {
      return this._createOptionalQueryAndRun('where', condition, 'delete', callback);
    };

    return ModelQuery;

  })();

  module.exports = ModelQuery;

}).call(this);
