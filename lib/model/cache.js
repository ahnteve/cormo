// Generated by CoffeeScript 1.7.1
(function() {
  var ModelCache, tableize;

  tableize = require('../inflector').tableize;

  ModelCache = (function() {
    function ModelCache() {}

    ModelCache._loadFromCache = function(key, refresh, callback) {
      if (refresh) {
        return callback('error');
      }
      return this._connection._connectRedisCache((function(_this) {
        return function(error, redis) {
          if (error) {
            return callback(error);
          }
          key = 'CC.' + tableize(_this._name) + ':' + key;
          return redis.get(key, function(error, data) {
            if (error || (data == null)) {
              return callback('error');
            }
            return callback(null, JSON.parse(data));
          });
        };
      })(this));
    };

    ModelCache._saveToCache = function(key, ttl, data, callback) {
      return this._connection._connectRedisCache((function(_this) {
        return function(error, redis) {
          if (error) {
            return callback(error);
          }
          key = 'CC.' + tableize(_this._name) + ':' + key;
          return redis.setex(key, ttl, JSON.stringify(data), function(error) {
            return callback(error);
          });
        };
      })(this));
    };

    ModelCache.removeCache = function(key, callback) {
      return this._connection._connectRedisCache((function(_this) {
        return function(error, redis) {
          if (error) {
            return callback(error);
          }
          key = 'CC.' + tableize(_this._name) + ':' + key;
          return redis.del(key, function(error) {
            return callback(null);
          });
        };
      })(this));
    };

    return ModelCache;

  })();

  module.exports = ModelCache;

}).call(this);
