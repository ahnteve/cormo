<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CORMO - Query</title><script>if (location.protocol.match(/^http/) && location.pathname.match('\.html') === null && location.pathname.slice(-1) !== '/') {
  location.href = location.href + '/';
}</script><link href="../bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--><link href="../google-code-prettify/prettify.css" rel="stylesheet" type="text/css"><link href="../style.css" rel="stylesheet" type="text/css"></head><body data-spy="scroll" data-target=".sidebar"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#top-navigation-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="top-navigation-collapse"><ul class="nav navbar-nav"><li><a href="../index.html">Home</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Guides <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../guides/Aggregation.html">Aggregation</a></li><li><a href="../guides/Association.html">Association</a></li><li><a href="../guides/Callback.html">Callback</a></li><li><a href="../guides/Constraint.html">Constraint</a></li><li><a href="../guides/CreateRecords.html">Create records</a></li><li><a href="../guides/DefineModels.html">Define models</a></li><li><a href="../guides/Geospatial.html">Geospatial</a></li><li><a href="../guides/Miscellaneous.html">Miscellaneous</a></li><li><a href="../guides/Query.html">Query</a></li><li><a href="../guides/Validation.html">Validation</a></li></ul></li><li><a href="../modules/index.html">Modules</a></li><li class="active"><a href="../classes/index.html">Classes - Query</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Files <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../files/decorators.ts.html">decorators.ts</a></li><li><a href="../files/index.ts.html">index.ts</a></li><li><a href="../files/query.ts.html">query.ts</a></li><li><a href="../files/transaction.ts.html">transaction.ts</a></li><li><a href="../files/types.ts.html">types.ts</a></li><li><a href="../files/adapters.base.ts.html">adapters/base.ts</a></li><li><a href="../files/adapters.index.ts.html">adapters/index.ts</a></li><li><a href="../files/adapters.mongodb.ts.html">adapters/mongodb.ts</a></li><li><a href="../files/adapters.mysql.ts.html">adapters/mysql.ts</a></li><li><a href="../files/adapters.postgresql.ts.html">adapters/postgresql.ts</a></li><li><a href="../files/adapters.redis.ts.html">adapters/redis.ts</a></li><li><a href="../files/adapters.sql_base.ts.html">adapters/sql_base.ts</a></li><li><a href="../files/adapters.sqlite3.ts.html">adapters/sqlite3.ts</a></li><li><a href="../files/adapters.sqlite3_memory.ts.html">adapters/sqlite3_memory.ts</a></li><li><a href="../files/command.index.ts.html">command/index.ts</a></li><li><a href="../files/connection.index.ts.html">connection/index.ts</a></li><li><a href="../files/logger.ColorConsoleLogger.ts.html">logger/ColorConsoleLogger.ts</a></li><li><a href="../files/logger.ConsoleLogger.ts.html">logger/ConsoleLogger.ts</a></li><li><a href="../files/logger.EmptyLogger.ts.html">logger/EmptyLogger.ts</a></li><li><a href="../files/logger.ILogger.ts.html">logger/ILogger.ts</a></li><li><a href="../files/logger.index.ts.html">logger/index.ts</a></li><li><a href="../files/model.index.ts.html">model/index.ts</a></li><li><a href="../files/util.index.ts.html">util/index.ts</a></li><li><a href="../files/util.inflector.ts.html">util/inflector.ts</a></li></ul></li></ul><div class="options"><label class="checkbox"><input id="options-private" type="checkbox"> Private </label></div></div></div></nav><div class="container-fluid content"><div class="row"><div class="hidden-xs sidebar col-sm-3" data-spy="affix"><div class="cormo-sidenav"><div class="panel panel-default"><div class="panel-collapse collapse in" id="undefined_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/BaseModel.html">BaseModel</a></li><li><a href="../classes/Command.html">Command</a></li><li><a href="../classes/Connection.html">Connection</a></li><li class="active"><a href="#Query">Query</a></li><li class="cormo-class-property"><a href="#Query__cache">cache</a></li><li class="cormo-class-property"><a href="#Query__count">count</a></li><li class="cormo-class-property"><a href="#Query__delete">delete</a></li><li class="cormo-class-property"><a href="#Query__endif">endif</a></li><li class="cormo-class-property"><a href="#Query__exec">exec</a></li><li class="cormo-class-property"><a href="#Query__explain">explain</a></li><li class="cormo-class-property"><a href="#Query__find">find</a></li><li class="cormo-class-property"><a href="#Query__findPreserve">findPreserve</a></li><li class="cormo-class-property"><a href="#Query__group">group</a></li><li class="cormo-class-property"><a href="#Query__if">if</a></li><li class="cormo-class-property"><a href="#Query__include">include</a></li><li class="cormo-class-property"><a href="#Query__lean">lean</a></li><li class="cormo-class-property"><a href="#Query__limit">limit</a></li><li class="cormo-class-property"><a href="#Query__near">near</a></li><li class="cormo-class-property"><a href="#Query__one">one</a></li><li class="cormo-class-property"><a href="#Query__order">order</a></li><li class="cormo-class-property"><a href="#Query__select">select</a></li><li class="cormo-class-property"><a href="#Query__skip">skip</a></li><li class="cormo-class-property"><a href="#Query__stream">stream</a></li><li class="cormo-class-property"><a href="#Query__then">then</a></li><li class="cormo-class-property"><a href="#Query__update">update</a></li><li class="cormo-class-property"><a href="#Query__upsert">upsert</a></li><li class="cormo-class-property"><a href="#Query__where">where</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#adapter_body">adapter<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="adapter_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/adapter.AdapterBase.html">AdapterBase</a></li></ul></div></div></div></div><div class="col-sm-9 col-sm-offset-3"><span class="fix-anchor" id="Query"></span><section><h1 class="class_title">Query</h1><div><p>Collects conditions to query</p>
</div><div></div><div class="panel panel-info"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query_ctor_body"><h3 class="panel-title">Constructor<span class="pull-right glyphicon"></span></h3></div><div class="panel-collapse collapse" id="Query_ctor_body"><div class="panel-body"><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L121">/src/query.ts:121</a>)</span></div><pre class="sourcecode prettyprint .linenums:121">constructor(model: typeof BaseModel) {
    this._model = model;
    this._name = model._name;
    this._connection = model._connection;
    this._adapter = model._connection._adapter;
    this._ifs = [];
    this._current_if = true;
    this._conditions = [];
    this._includes = [];
    this._options = {
      conditions_of_group: [],
      lean: model.lean_query,
      select_single: false,
    };
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__cache"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__cache_body"><h3 class="panel-title">Query::cache()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Cache result.</p>
</div></div><div class="panel-collapse collapse" id="Query__cache_body"><div class="panel-body"><div><p>If cache of key exists, actual query does not performed.
If cache does not exist, query result will be saved in cache.</p>
<p>Redis is used to cache.</p>
</div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L342">/src/query.ts:342</a>)</span></div><pre class="sourcecode prettyprint .linenums:342">public cache(options: IQueryOptions['cache']): this {
    if (!this._current_if) {
      return this;
    }
    this._options.cache = options;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__count"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__count_body"><h3 class="panel-title">Query::count()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query as a count operation</p>
</div></div><div class="panel-collapse collapse" id="Query__count_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L438">/src/query.ts:438</a>)</span></div><pre class="sourcecode prettyprint .linenums:438">public async count(): Promise&lt;number&gt; {
    await this._model._checkReady();
    if (this._id || this._find_single_id) {
      this._conditions.push({ id: this._id });
      delete this._id;
    }
    return await this._adapter.count(this._name, this._conditions, this._options);
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__delete"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__delete_body"><h3 class="panel-title">Query::delete()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query as a delete operation</p>
</div></div><div class="panel-collapse collapse" id="Query__delete_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L491">/src/query.ts:491</a>)</span></div><pre class="sourcecode prettyprint .linenums:491">public async delete(options?: any): Promise&lt;number&gt; {
    await this._model._checkReady();
    if (this._id || this._find_single_id) {
      this._conditions.push({ id: this._id });
      delete this._id;
    }
    if (!(options &amp;&amp; options.skip_log)) {
      this._connection.log(this._name, 'delete', { conditions: this._conditions });
    }
    await this._doArchiveAndIntegrity(options);
    return await this._adapter.delete(this._name, this._conditions, { transaction: this._options.transaction });
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__endif"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__endif_body"><h3 class="panel-title">Query::endif()<span class="label label-chainable">chainable</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Ends last if</p>
</div></div><div class="panel-collapse collapse" id="Query__endif_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>(Returns)</td><td><span><a href='../classes/Query.html#Query'>Query</a></span></td><td><span>this</span></td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L325">/src/query.ts:325</a>)</span></div><pre class="sourcecode prettyprint .linenums:325">public endif() {
    this._ifs.pop();
    this._current_if = true;
    for (const condition of this._ifs) {
      this._current_if = this._current_if &amp;&amp; condition;
    }
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__exec"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__exec_body"><h3 class="panel-title">Query::exec()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query</p>
</div></div><div class="panel-collapse collapse" id="Query__exec_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L371">/src/query.ts:371</a>)</span></div><pre class="sourcecode prettyprint .linenums:371">public async exec(options?: { skip_log?: boolean }) {
    await this._model._checkReady();
    if (this._options.cache &amp;&amp; this._options.cache.key) {
      try {
        // try cache
        return await this._model._loadFromCache(this._options.cache.key, this._options.cache.refresh);
      } catch (error) {
        // no cache, execute query
        const records = await this._execAndInclude(options);
        // save result to cache
        await this._model._saveToCache(this._options.cache.key, this._options.cache.ttl, records);
        return records;
      }
    } else {
      return await this._execAndInclude(options);
    }
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__explain"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__explain_body"><h3 class="panel-title">Query::explain()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Explains the query</p>
</div></div><div class="panel-collapse collapse" id="Query__explain_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L412">/src/query.ts:412</a>)</span></div><pre class="sourcecode prettyprint .linenums:412">public async explain() {
    this._options.cache = undefined;
    this._options.explain = true;
    this._includes = [];
    return await this.exec({ skip_log: true });
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__find"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__find_body"><h3 class="panel-title">Query::find()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Finds a record by id</p>
</div></div><div class="panel-collapse collapse" id="Query__find_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L140">/src/query.ts:140</a>)</span></div><pre class="sourcecode prettyprint .linenums:140">public find(id: RecordID): IQuerySingle&lt;M, T&gt;;</pre></div></div></div></section><span class="fix-anchor" id="Query__findPreserve"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__findPreserve_body"><h3 class="panel-title">Query::findPreserve()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Finds records by ids while preserving order.</p>
</div></div><div class="panel-collapse collapse" id="Query__findPreserve_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L159">/src/query.ts:159</a>)</span></div><pre class="sourcecode prettyprint .linenums:159">public findPreserve(ids: RecordID[]): IQueryArray&lt;M, T&gt; {
    if (!this._current_if) {
      return this;
    }
    this._id = _.uniq(ids);
    this._find_single_id = false;
    this._preserve_order_ids = ids;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__group"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__group_body"><h3 class="panel-title">Query::group()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Groups result records</p>
</div></div><div class="panel-collapse collapse" id="Query__group_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L245">/src/query.ts:245</a>)</span></div><pre class="sourcecode prettyprint .linenums:245">public group&lt;U&gt;(group_by: string | string[] | null, fields?: object): IQuerySingle&lt;M, U&gt;;</pre></div></div></div></section><span class="fix-anchor" id="Query__if"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__if_body"><h3 class="panel-title">Query::if()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Makes a part of the query chain conditional</p>
</div></div><div class="panel-collapse collapse" id="Query__if_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L314">/src/query.ts:314</a>)</span></div><pre class="sourcecode prettyprint .linenums:314">public if(condition: boolean): this {
    this._ifs.push(condition);
    this._current_if = this._current_if &amp;&amp; condition;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__include"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__include_body"><h3 class="panel-title">Query::include()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Returns associated objects also</p>
</div></div><div class="panel-collapse collapse" id="Query__include_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L353">/src/query.ts:353</a>)</span></div><pre class="sourcecode prettyprint .linenums:353">public include(column: any, select: any): this {
    if (!this._current_if) {
      return this;
    }
    this._includes.push({ column, select });
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__lean"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__lean_body"><h3 class="panel-title">Query::lean()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Returns raw instances instead of model instances</p>
</div></div><div class="panel-collapse collapse" id="Query__lean_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L302">/src/query.ts:302</a>)</span></div><pre class="sourcecode prettyprint .linenums:302">public lean(lean = true): this {
    if (!this._current_if) {
      return this;
    }
    this._options.lean = lean;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__limit"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__limit_body"><h3 class="panel-title">Query::limit()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Sets limit of query</p>
</div></div><div class="panel-collapse collapse" id="Query__limit_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L279">/src/query.ts:279</a>)</span></div><pre class="sourcecode prettyprint .linenums:279">public limit(limit: number): this {
    if (!this._current_if) {
      return this;
    }
    this._options.limit = limit;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__near"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__near_body"><h3 class="panel-title">Query::near()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Finds records near target</p>
</div></div><div class="panel-collapse collapse" id="Query__near_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L172">/src/query.ts:172</a>)</span></div><pre class="sourcecode prettyprint .linenums:172">public near(target: object): this {
    if (!this._current_if) {
      return this;
    }
    this._options.near = target;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__one"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__one_body"><h3 class="panel-title">Query::one()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Returns only one record (or null if does not exists).</p>
</div></div><div class="panel-collapse collapse" id="Query__one_body"><div class="panel-body"><div><p>This is different from limit(1). limit(1) returns array of length 1 while this returns an instance.</p>
</div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L267">/src/query.ts:267</a>)</span></div><pre class="sourcecode prettyprint .linenums:267">public one(): this {
    if (!this._current_if) {
      return this;
    }
    this._options.limit = 1;
    this._options.one = true;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__order"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__order_body"><h3 class="panel-title">Query::order()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Specifies orders of result</p>
</div></div><div class="panel-collapse collapse" id="Query__order_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L234">/src/query.ts:234</a>)</span></div><pre class="sourcecode prettyprint .linenums:234">public order(orders?: string): this {
    if (!this._current_if) {
      return this;
    }
    this._options.orders = orders;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__select"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__select_body"><h3 class="panel-title">Query::select()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Selects columns for result</p>
</div></div><div class="panel-collapse collapse" id="Query__select_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L200">/src/query.ts:200</a>)</span></div><pre class="sourcecode prettyprint .linenums:200">public select&lt;K extends ModelColumnNamesWithId&lt;M&gt;&gt;(columns?: string | string[]): IQuerySingle&lt;M, Pick&lt;M, K&gt;&gt;;</pre></div></div></div></section><span class="fix-anchor" id="Query__skip"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__skip_body"><h3 class="panel-title">Query::skip()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Sets skip of query</p>
</div></div><div class="panel-collapse collapse" id="Query__skip_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L290">/src/query.ts:290</a>)</span></div><pre class="sourcecode prettyprint .linenums:290">public skip(skip: number): this {
    if (!this._current_if) {
      return this;
    }
    this._options.skip = skip;
    return this;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__stream"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__stream_body"><h3 class="panel-title">Query::stream()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query and returns a readable stream</p>
</div></div><div class="panel-collapse collapse" id="Query__stream_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L394">/src/query.ts:394</a>)</span></div><pre class="sourcecode prettyprint .linenums:394">public stream(): stream.Readable {
    const transformer = new stream.Transform({ objectMode: true });
    transformer._transform = function(chunk, encoding, callback) {
      this.push(chunk);
      callback();
    };
    this._model._checkReady().then(() =&gt; {
      this._adapter.stream(this._name, this._conditions, this._getAdapterFindOptions())
        .on('error', (error) =&gt; {
          transformer.emit('error', error);
        }).pipe(transformer);
    });
    return transformer;
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__then"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__then_body"><h3 class="panel-title">Query::then()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query as a promise (.then == .exec().then)</p>
</div></div><div class="panel-collapse collapse" id="Query__then_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L422">/src/query.ts:422</a>)</span></div><pre class="sourcecode prettyprint .linenums:422">public then&lt;TResult1 = T, TResult2 = never&gt;(
    onfulfilled?: ((value: T) =&gt; TResult1 | PromiseLike&lt;TResult1&gt;) |
      ((value: T[]) =&gt; TResult1 | PromiseLike&lt;TResult1&gt;) | undefined | null,
    onrejected?: ((reason: any) =&gt; TResult2 | PromiseLike&lt;TResult2&gt;) | undefined | null,
  ): PromiseLike&lt;TResult1 | TResult2&gt;;</pre></div></div></div></section><span class="fix-anchor" id="Query__update"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__update_body"><h3 class="panel-title">Query::update()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query as a update operation</p>
</div></div><div class="panel-collapse collapse" id="Query__update_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L451">/src/query.ts:451</a>)</span></div><pre class="sourcecode prettyprint .linenums:451">public async update(updates: any): Promise&lt;number&gt; {
    await this._model._checkReady();
    const errors: any[] = [];
    const data = {};
    this._validateAndBuildSaveData(errors, data, updates, '', updates);
    if (errors.length &gt; 0) {
      throw new Error(errors.join(','));
    }
    if (this._id || this._find_single_id) {
      this._conditions.push({ id: this._id });
      delete this._id;
    }
    this._connection.log(this._name, 'update', { data, conditions: this._conditions, options: this._options });
    return await this._adapter.updatePartial(this._name, data, this._conditions, this._options);
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__upsert"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__upsert_body"><h3 class="panel-title">Query::upsert()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Executes the query as an insert or update operation</p>
</div></div><div class="panel-collapse collapse" id="Query__upsert_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><h4>See Also:</h4><ul><li></li></ul><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L471">/src/query.ts:471</a>)</span></div><pre class="sourcecode prettyprint .linenums:471">public async upsert(updates: any): Promise&lt;void&gt; {
    await this._model._checkReady();
    const errors: any[] = [];
    const data = {};
    this._validateAndBuildSaveData(errors, data, updates, '', updates);
    if (errors.length &gt; 0) {
      throw new Error(errors.join(','));
    }
    if (this._id || this._find_single_id) {
      this._conditions.push({ id: this._id });
      delete this._id;
    }
    this._connection.log(this._name, 'upsert', { data, conditions: this._conditions, options: this._options });
    return await this._adapter.upsert(this._name, data, this._conditions, this._options);
  }</pre></div></div></div></section><span class="fix-anchor" id="Query__where"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#Query__where_body"><h3 class="panel-title">Query::where()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Finds records by condition</p>
</div></div><div class="panel-collapse collapse" id="Query__where_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in <a href="https://github.com/croquiscom/cormo/blob/master//src/query.ts#L183">/src/query.ts:183</a>)</span></div><pre class="sourcecode prettyprint .linenums:183">public where(condition?: object): this {
    if (!this._current_if) {
      return this;
    }
    if (Array.isArray(condition)) {
      condition.forEach((cond) =&gt; {
        this._addCondition(cond);
      });
    } else if (condition != null) {
      this._addCondition(condition);
    }
    return this;
  }</pre></div></div></div></section></div></div></div><script src="http://code.jquery.com/jquery-1.11.0.min.js"></script><script src="../bootstrap-3.2.0-dist/js/bootstrap.min.js"></script><script src="../google-code-prettify/prettify.js"></script><script src="../script.js"></script><script src="../group-examples.js"></script><a href="https://github.com/croquiscom/cormo"><img class="github-ribbon" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a></body></html>